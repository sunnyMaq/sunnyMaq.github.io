window.onload=function(){var oBtn=document.getElementById("btn1");var oT=document.getElementById("t1");var oBox=document.getElementById("msg_box");var oPageBox=document.getElementById("page_box");var nowPage=1;var url="weibo.php";oBtn.onclick=function(){ajax({url:url,data:{act:"add",content:oT.value},fnSucc:function(str){var json=new Function("return "+str)();if(json.error){alert("添加失败！")}else{var oDiv=createMsg(json.time,oT.value,0,0,json.id);if(oBox.children.length){oBox.insertBefore(oDiv,oBox.children[0])}else{oBox.appendChild(oDiv)}if(oBox.children.length==7){oBox.removeChild(oBox.children[6])}}getPageCount();oT.value=""}})};function createMsg(time,content,acc,ref,id){var oDate=new Date();oDate.setTime(time*1000);var str=oDate.getFullYear()+"-"+(oDate.getMonth()+1)+"-"+oDate.getDate()+" "+oDate.getHours()+":"+oDate.getMinutes()+":"+oDate.getSeconds();var oDiv=document.createElement("div");oDiv.className="reply";oDiv.innerHTML='<p class="replyContent">'+content+"</p>"+'<p class="operation">'+'<span class="replyTime">'+str+"</span>"+'<span class="handle">'+'<a href="javascript:;" class="top">'+acc+"</a>"+'<a href="javascript:;" class="down_icon">'+ref+"</a>"+'<a href="javascript:;" class="cut">删除</a>';+"</span>"+"</p>";var aA=oDiv.getElementsByTagName("a");aA[2].onclick=function(){var t=confirm("你确认删除吗？");if(t){ajax({url:url,data:{act:"del",id:id},fnSucc:function(str){var json=new Function("return "+str);if(json.error){alert("删除失败！")}else{oBox.removeChild(oDiv);getPageCount();getMsg(nowPage)}}})}};aA[0].onclick=function(){if(!getCookie(("acc"+id))){ajax({url:url,data:{act:"acc",id:id},fnSucc:function(str){var json=new Function("return "+str)();if(json.error){alert("顶失败")}else{aA[0].innerHTML=parseInt(aA[0].innerHTML)+1;setCookie("acc"+id,1,1)}}})}else{alert("亲！一天只能顶一次！")}};aA[1].onclick=function(){if(!getCookie(("ref"+id))){ajax({url:url,data:{act:"ref",id:id},fnSucc:function(str){var json=new Function("return "+str)();if(json.error){alert("踩失败")}else{aA[1].innerHTML=parseInt(aA[1].innerHTML)+1;setCookie("ref"+id,1,1)}}})}else{alert("亲！一天只能踩一次！")}};return oDiv}function getMsg(n){oBox.innerHTML="";ajax({url:url,data:{act:"get",page:n},fnSucc:function(str){var arr=new Function("return "+str)();for(var i=0;i<arr.length;i++){var oDiv=createMsg(arr[i].time,arr[i].content,arr[i].acc,arr[i].ref,arr[i].id);oBox.appendChild(oDiv)}}})}getMsg();function getPageCount(){oPageBox.innerHTML="";ajax({url:url,data:{act:"get_page_count"},fnSucc:function(str){var num=new Function("return "+str)().count;for(var i=0;i<num;i++){var oA=document.createElement("a");oA.href="javascript:;";oA.innerHTML=i+1;if(i==0){oA.className="active"}oA.onclick=function(){for(var i=0;i<oPageBox.children.length;i++){oPageBox.children[i].className=""}this.className="active";nowPage=this.innerHTML;getMsg(this.innerHTML)};oPageBox.appendChild(oA)}}})}getPageCount()};